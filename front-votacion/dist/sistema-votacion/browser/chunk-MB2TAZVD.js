import{a as x}from"./chunk-C2IP46QI.js";import{a as V}from"./chunk-OXAWYZPD.js";import{a as I}from"./chunk-XPYVCOT5.js";import{a as S,c as de,d as le,h as me}from"./chunk-ZLLD3L34.js";import{D as g,Ea as H,F as c,Ga as Z,H as r,Ha as W,I as t,J as F,K as N,L as j,La as K,M as O,Ma as Q,Na as X,O as v,Oa as Y,P as m,Pa as $,Q as w,Qa as ee,R as q,Ra as te,S as h,T as C,Ta as ie,U as b,Ua as ne,Va as oe,Wa as re,Ya as ae,da as U,ea as J,f as k,h as T,ia as z,l as M,ma as G,p as L,q as A,r as f,s as _,x as a,y}from"./chunk-ZHU3U647.js";function ue(n,o){if(n&1&&(r(0,"option",44),m(1),t()),n&2){let u=o.$implicit;c("value",u.tipo_documento),a(),w(u.tipo_documento)}}function ge(n,o){n&1&&(r(0,"div",45),m(1," El tipo de documento es obligatorio. "),t())}function fe(n,o){n&1&&(r(0,"div",45),m(1," El n\xFAmero de documento es obligatorio. "),t())}function _e(n,o){n&1&&(r(0,"div",45),m(1," El nombre es obligatorio. "),t())}function ve(n,o){n&1&&(r(0,"div",45),m(1," El correo es obligatorio y debe ser v\xE1lido. "),t())}function he(n,o){n&1&&(r(0,"div",45),m(1," La contrase\xF1a debe tener al menos 8 caracteres, una letra may\xFAscula, un n\xFAmero y un car\xE1cter especial. "),t())}function Ce(n,o){n&1&&(r(0,"div",45),m(1," El tel\xE9fono debe tener entre 7 y 10 d\xEDgitos. "),t())}function be(n,o){if(n&1){let u=N();r(0,"li",46)(1,"div",47)(2,"input",48),j("change",function(){let d=f(u).$implicit,e=O();return _(e.toggleSelection(d))}),t(),r(3,"label",49),m(4),t()()()}if(n&2){let u=o.$implicit,l=O();a(2),c("id","option-"+u.id_conjunto)("checked",l.isSelected(u))("disabled",l.isEditMode),a(),c("for","option-"+u.id_conjunto),a(),q(" ",u.nombre," ")}}function ye(n,o){n&1&&(r(0,"div",50),m(1," El conjunto es obligatorio. "),t())}function Se(n,o){if(n&1&&(r(0,"option",44),m(1),t()),n&2){let u=o.$implicit;c("value",u.id_rol),a(),w(u.tipo_rol)}}function we(n,o){n&1&&(r(0,"div",45),m(1," El rol es obligatorio. "),t())}var ce=(()=>{let o=class o{constructor(l,d,e,s,p){this.router=l,this.route=d,this.adminService=e,this.conjuntoService=s,this.adminConjuntoService=p,this.roles=[],this.conjuntos=[],this.documentos=[],this.admin={},this.selectedOptions=[],this.isEditMode=!1,this.titulo="Crear nuevo administrador"}ngOnInit(){this.route.params.subscribe(i=>{this.id=+i.id,this.id&&(this.isEditMode=!0,this.titulo="Editar administrador",this.getAdminById())});let l=JSON.parse(localStorage.getItem("roles")??"{}");this.roles=l.respuesta?.filter(i=>i.id_rol!==1)||[];let e=JSON.parse(localStorage.getItem("currentUser")??"{}").nombre||"Usuario desconocido";this.admin.usuario_modificacion=e;let s=JSON.parse(localStorage.getItem("documentos")??"{}");this.documentos=s.respuesta;let p=new Date;this.admin.ultima_modificacion=p.toISOString().split("T")[0],this.conjuntoService.get(S.getAllConjuntos).subscribe(i=>{this.conjuntos=i.respuesta||[]})}isSelected(l){return this.selectedOptions.includes(l)}toggleSelection(l){this.isSelected(l)?this.selectedOptions=this.selectedOptions.filter(d=>d.id_conjunto!==l.id_conjunto):this.selectedOptions.push(l)}saveAdmin(l){return k(this,null,function*(){if(!l.valid){console.log("Formulario inv\xE1lido");return}try{let d;if(this.id)this.admin.pass=this.admin.password??null,this.adminService.put(S.updateAdmin,this.id,this.admin).subscribe({next:e=>{console.log("Administrador editado exitosamente:",e),this.router.navigate(["/administradores"])},error:e=>{console.error("Error al editar administrador:",e),e.status===401?(console.error("No autorizado, redirigiendo al login"),this.router.navigate(["/login"])):console.error("Error no manejado:",e)}});else{if(!this.selectedOptions.length){alert("Debe seleccionar al menos un conjunto antes de continuar.");return}let e=yield T(this.adminService.post(S.createAdmin,this.admin));if(d=e.id_admin,!d){console.error("Error al crear el administrador:",e),alert("Error al crear el administrador");return}let s=d;console.log("ID del nuevo administrador creado:",s);let p=this.selectedOptions.map(i=>{let E={id_admin:s,id_conjunto:i.id_conjunto};return T(this.adminConjuntoService.post(S.createAdminConjunto,E))});yield Promise.all(p),console.log("Conjuntos registrados exitosamente")}l.reset(),this.router.navigate(["/administradores"])}catch(d){d instanceof G?(console.error("Error al procesar el formulario:",d),d.status===500?alert("Error en el servidor: "+(d.error?.msg||"Error desconocido")):alert("Error al procesar el formulario: "+d.message)):(console.error("Error desconocido:",d),alert("Error desconocido al procesar el formulario."))}})}getAdminById(){this.id&&this.adminService.getById(S.getAllAdmins,this.id).subscribe(l=>{if(l&&l.respuesta&&l.respuesta.length>0){let d=l.respuesta[0];this.admin=d}else console.error("No se encontr\xF3 el administrador o la respuesta est\xE1 vac\xEDa")},l=>{console.error("Error al obtener el administrador:",l)})}volver(){this.router.navigate(["/administradores"])}};o.\u0275fac=function(d){return new(d||o)(y(Z),y(H),y(x),y(V),y(I))},o.\u0275cmp=L({type:o,selectors:[["app-creacion-admin"]],decls:74,vars:23,consts:[["adminForm","ngForm"],["tipoDocumento","ngModel"],["nroDocumento","ngModel"],["nombre","ngModel"],["correo","ngModel"],["password","ngModel"],["telefono","ngModel"],["idRol","ngModel"],[1,"container","py-3"],[1,"abs-center"],[1,"card","shadow","border-0"],[1,"card-body"],[1,"text-center","fs-2","text-primary","mb-4"],[1,"row","g-3",3,"ngSubmit"],[1,"col-md-6"],["for","tipoDocumento",1,"form-label"],["id","tipoDocumento","name","id_tipo_documento","required","",1,"form-select",3,"ngModelChange","ngModel"],["disabled","",3,"value"],[3,"value",4,"ngFor","ngForOf"],["class","text-danger",4,"ngIf"],["for","nroDocumento",1,"form-label"],["id","nroDocumento","type","number","name","nro_documento","required","",1,"form-control",3,"ngModelChange","ngModel"],[1,"mb-3"],["for","nombre",1,"form-label"],["id","nombre","type","text","name","nombre","required","",1,"form-control",3,"ngModelChange","ngModel"],["for","correo",1,"form-label"],["id","correo","type","email","name","correo","required","",1,"form-control",3,"ngModelChange","ngModel"],["for","password",1,"form-label"],["id","password","type","password","name","password","pattern","^(?=.*[A-Z])(?=.*\\d)(?=.*[!@#$%^&*()_+\\[\\]{};':\\\\|,.\\/?]).{8,}$",1,"form-control",3,"ngModelChange","ngModel"],["for","telefono",1,"form-label"],["id","telefono","type","tel","name","telefono","required","","pattern","[0-9]{7,10}",1,"form-control",3,"ngModelChange","ngModel"],[1,"col-md-6","mb-3"],["for","idConjunto",1,"form-label"],[1,"dropdown"],["type","button","id","dropdownConjunto","data-bs-toggle","dropdown","aria-expanded","false",1,"btn","btn-primary","w-100","dropdown-toggle"],["aria-labelledby","dropdownConjunto",1,"dropdown-menu","w-100"],["class","px-3 py-2",4,"ngFor","ngForOf"],["class","text-danger mt-1",4,"ngIf"],["for","idRol",1,"form-label"],["id","idRol","name","id_rol","required","",1,"form-select",3,"ngModelChange","ngModel"],[1,"row","mt-3"],[1,"col"],["type","submit",1,"btn","btn-primary","me-2","w-100","w-md-auto",3,"disabled"],["type","button",1,"btn","btn-secondary","w-100","w-md-auto",3,"click"],[3,"value"],[1,"text-danger"],[1,"px-3","py-2"],[1,"form-check"],["type","checkbox",1,"form-check-input",3,"change","id","checked","disabled"],[1,"form-check-label",2,"white-space","nowrap",3,"for"],[1,"text-danger","mt-1"]],template:function(d,e){if(d&1){let s=N();F(0,"app-nav"),r(1,"div",8)(2,"div",9)(3,"div",10)(4,"div",11)(5,"h2",12),m(6),t(),r(7,"form",13,0),j("ngSubmit",function(){f(s);let i=v(8);return _(e.saveAdmin(i))}),r(9,"div",14)(10,"label",15),m(11,"Tipo de Documento"),t(),r(12,"select",16,1),b("ngModelChange",function(i){return f(s),C(e.admin.id_tipo_documento,i)||(e.admin.id_tipo_documento=i),_(i)}),r(14,"option",17),m(15,"Seleccione un tipo de documento"),t(),g(16,ue,2,2,"option",18),t(),g(17,ge,2,0,"div",19),t(),r(18,"div",14)(19,"label",20),m(20,"N\xFAmero de Documento"),t(),r(21,"input",21,2),b("ngModelChange",function(i){return f(s),C(e.admin.nro_documento,i)||(e.admin.nro_documento=i),_(i)}),t(),g(23,fe,2,0,"div",19),t(),r(24,"div",22)(25,"label",23),m(26,"Nombre"),t(),r(27,"input",24,3),b("ngModelChange",function(i){return f(s),C(e.admin.nombre,i)||(e.admin.nombre=i),_(i)}),t(),g(29,_e,2,0,"div",19),t(),r(30,"div",14)(31,"label",25),m(32,"Correo"),t(),r(33,"input",26,4),b("ngModelChange",function(i){return f(s),C(e.admin.correo,i)||(e.admin.correo=i),_(i)}),t(),g(35,ve,2,0,"div",19),t(),r(36,"div",14)(37,"label",27),m(38,"Contrase\xF1a"),t(),r(39,"input",28,5),b("ngModelChange",function(i){return f(s),C(e.admin.password,i)||(e.admin.password=i),_(i)}),t(),g(41,he,2,0,"div",19),t(),r(42,"div",22)(43,"label",29),m(44,"Tel\xE9fono"),t(),r(45,"input",30,6),b("ngModelChange",function(i){return f(s),C(e.admin.telefono,i)||(e.admin.telefono=i),_(i)}),t(),g(47,Ce,2,0,"div",19),t(),r(48,"div",31)(49,"label",32),m(50,"Conjunto"),t(),r(51,"div",33)(52,"button",34),m(53," Seleccionar conjunto "),t(),r(54,"ul",35),g(55,be,5,5,"li",36),t()(),g(56,ye,2,0,"div",37),t(),r(57,"div",14)(58,"label",38),m(59,"Rol"),t(),r(60,"select",39,7),b("ngModelChange",function(i){return f(s),C(e.admin.id_rol,i)||(e.admin.id_rol=i),_(i)}),r(62,"option",17),m(63,"Seleccione un rol"),t(),g(64,Se,2,2,"option",18),t(),g(65,we,2,0,"div",19),t(),r(66,"div",40)(67,"div",41)(68,"button",42),m(69),t()(),r(70,"div",41)(71,"button",43),j("click",function(){return f(s),_(e.volver())}),m(72,"Volver"),t()()()()()()()(),F(73,"app-footer")}if(d&2){let s=v(8),p=v(13),i=v(22),E=v(28),D=v(34),P=v(40),B=v(46),R=v(61);a(6),w(e.titulo),a(6),h("ngModel",e.admin.id_tipo_documento),a(2),c("value",null),a(2),c("ngForOf",e.documentos),a(),c("ngIf",p.invalid&&p.touched),a(4),h("ngModel",e.admin.nro_documento),a(2),c("ngIf",i.invalid&&i.touched),a(4),h("ngModel",e.admin.nombre),a(2),c("ngIf",E.invalid&&E.touched),a(4),h("ngModel",e.admin.correo),a(2),c("ngIf",D.invalid&&D.touched),a(4),h("ngModel",e.admin.password),a(2),c("ngIf",P.invalid&&P.touched),a(4),h("ngModel",e.admin.telefono),a(2),c("ngIf",B.invalid&&B.touched),a(8),c("ngForOf",e.conjuntos),a(),c("ngIf",!e.selectedOptions.length&&(s==null?null:s.submitted)),a(4),h("ngModel",e.admin.id_rol),a(2),c("value",null),a(2),c("ngForOf",e.roles),a(),c("ngIf",R.invalid&&R.touched),a(3),c("disabled",s.invalid),a(),w(e.titulo)}},dependencies:[U,J,ee,ne,oe,K,te,ie,Q,X,re,ae,$,Y,de,le],styles:[".abs-center[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;min-height:70vh}.card[_ngcontent-%COMP%]{min-width:90vw}.container[_ngcontent-%COMP%]{padding:1rem}"]});let n=o;return n})();var Ee=[{path:"",component:ce}],pe=(()=>{let o=class o{};o.\u0275fac=function(d){return new(d||o)},o.\u0275mod=A({type:o}),o.\u0275inj=M({imports:[W.forChild(Ee),W]});let n=o;return n})();var Ke=(()=>{let o=class o{};o.\u0275fac=function(d){return new(d||o)},o.\u0275mod=A({type:o}),o.\u0275inj=M({providers:[x,V,I],imports:[z,pe,me]});let n=o;return n})();export{Ke as CreacionAdminModule};
