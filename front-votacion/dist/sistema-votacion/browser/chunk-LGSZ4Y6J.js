import{a as I}from"./chunk-2BIOR5CR.js";import{a as C}from"./chunk-EUPQWNRB.js";import{a as x}from"./chunk-3MGN2CRD.js";import{a as _,c as X,d as Z,h as ee}from"./chunk-ZLLD3L34.js";import{D as y,E as P,Ea as W,F as p,Ga as Y,H as s,Ha as F,I as d,J as V,K as w,L as S,La as q,M as g,Ma as $,N as M,Na as G,O as E,Oa as H,P as u,Pa as L,Q as j,Qa as z,R as N,S as k,Sa as K,T as A,U,V as T,Wa as Q,ca as R,da as D,ea as B,ia as J,l as h,p as O,q as b,r as v,s as f,x as a,y as m}from"./chunk-ZHU3U647.js";var ne=r=>({show:r});function ae(r,i){r&1&&(s(0,"div",15),u(1," No hay preguntas disponibles. "),d())}function se(r,i){if(r&1){let l=w();s(0,"div")(1,"div",26)(2,"input",27),U("ngModelChange",function(t){v(l);let e=g().$implicit,n=g();return A(n.opcionSeleccionada[e.id_pregunta],t)||(n.opcionSeleccionada[e.id_pregunta]=t),f(t)}),d(),s(3,"label",28),u(4),d()()()}if(r&2){let l=i.$implicit,o=i.index,t=g().$implicit,e=g();a(2),M("name","opcion",t.id_pregunta,""),p("value",l.id_opcion)("id","opcion"+t.id_pregunta+"_"+o),k("ngModel",e.opcionSeleccionada[t.id_pregunta]),p("disabled",t.estado!=="Activo"||e.yaVoto[t.id_pregunta]),a(),p("for","opcion"+t.id_pregunta+"_"+o),a(),N(" ",l.opcion," ")}}function ce(r,i){r&1&&(s(0,"div",29),u(1," Ya respondiste esta pregunta "),d())}function de(r,i){r&1&&(s(0,"div",30),u(1," Pregunta cerrada. "),d())}function le(r,i){if(r&1&&(s(0,"div",16)(1,"div",17)(2,"h2",18)(3,"button",19),u(4),d()(),s(5,"div",20)(6,"div",21)(7,"h3",22),u(8,"Opciones:"),d(),y(9,se,5,8,"div",23)(10,ce,2,0,"div",24)(11,de,2,0,"div",25),d()()()()),r&2){let l=i.$implicit,o=i.index,t=g();a(3),P("data-bs-target","#collapse"+l.id_pregunta)("aria-controls","collapse"+l.id_pregunta)("aria-expanded",o===0?"true":"false"),a(),N(" ",l.descripcion," "),a(),p("id","collapse"+l.id_pregunta)("ngClass",T(9,ne,o===t.preguntas.length-1)),a(4),p("ngForOf",t.opciones[l.id_pregunta]),a(),p("ngIf",t.yaVoto[l.id_pregunta]),a(),p("ngIf",l.estado!=="Activo")}}var ie=(()=>{let i=class i{constructor(o,t,e,n,c){this.router=o,this.route=t,this.preguntasService=e,this.opcionesService=n,this.votacionService=c,this.descripcion="",this.preguntas=[],this.opciones={},this.admin={},this.votacion={},this.usuario={},this.yaVoto={},this.currentRole=0,this.opcionSeleccionada={}}ngOnInit(){this.route.params.subscribe(c=>{this.id=+c.id,this.id&&this.refreshAsambleasYOpciones()});let t=JSON.parse(localStorage.getItem("currentUser")||"{}").id_usuario||"Usuario desconocido";this.usuario.id_usuario=t;let e=JSON.parse(localStorage.getItem("asambleaId")??"{}");this.asambleaId=e.id_asamblea||0;let n=JSON.parse(localStorage.getItem("currentUser")||"{}");this.currentRole=n.id_rol||0}votar(o){let t=this.preguntas.filter(e=>e.estado==="Activo").map(e=>({id_usuario:this.usuario.id_usuario,id_opcion:this.opcionSeleccionada[e.id_pregunta],id_pregunta:e.id_pregunta})).filter(e=>e.id_opcion!==null&&!this.yaVoto[e.id_pregunta]);if(t.length===0){alert("Debe seleccionar una opci\xF3n para al menos una pregunta activa.");return}this.votacionService.post(_.createVotacion,t).subscribe({next:e=>{this.router.navigate(["/preguntas",this.asambleaId]),t.forEach(n=>{this.yaVoto[n.id_pregunta]=!0})},error:e=>{console.error("Error al enviar las votaciones:",e),e.status===401?this.router.navigate(["/login"]):alert("Hubo un error al enviar tus votaciones. Intenta nuevamente.")}})}refreshAsambleasYOpciones(){this.id&&this.preguntasService.getById(_.getAllPreguntas,this.id).subscribe({next:o=>{let t=o?.respuesta||[];this.preguntas=t,t.forEach(e=>{e.estado=="Activo"&&(this.opciones[e.id_pregunta]=[]),this.opcionesService.getById(_.getAllOpciones,e.id_pregunta).subscribe({next:n=>{this.opciones[e.id_pregunta]=n?.respuesta||[],this.votacionService.getVotacionRespuesta(_.obtenerVotacion,this.usuario.id_usuario,e.id_pregunta).subscribe({next:c=>{c&&c.mensaje&&c.mensaje.id_opcion&&(this.opcionSeleccionada[e.id_pregunta]=c.mensaje.id_opcion,this.yaVoto[e.id_pregunta]=!0)},error:c=>{console.error("Error al obtener la respuesta de votaci\xF3n",c)}})},error:n=>console.error("Error al obtener opciones:",n)})})},error:o=>console.error("Error al obtener preguntas:",o)})}resultados(){this.router.navigate(["/home/resultado",this.asambleaId])}volver(o){switch(o){case 1:this.router.navigate(["/home"]);break;case 2:this.router.navigate(["/asambleas"]);break;case 3:this.router.navigate(["/asambleas"]);break;default:this.router.navigate(["/"]);break}}};i.\u0275fac=function(t){return new(t||i)(m(Y),m(W),m(x),m(C),m(I))},i.\u0275cmp=O({type:i,selectors:[["app-preguntas-us"]],decls:21,vars:4,consts:[["votoForm","ngForm"],[1,"container","py-3"],[1,"abs-center"],[1,"card","shadow","border-0"],[1,"card-body"],["class","alert alert-danger mt-4",4,"ngIf"],["id","id_asamblea","name","id_asamblea"],[1,"text-center","fs-2","text-primary","mb-4"],["id","accordionExample",1,"accordion"],[3,"ngSubmit"],["class","p-1",4,"ngFor","ngForOf"],[1,"d-flex","flex-column","align-items-center","mt-4"],["type","submit",1,"btn","btn-success","w-100","mb-2",3,"disabled"],["type","button",1,"btn","btn-primary","w-100","mb-2",3,"click"],["type","button",1,"btn","btn-secondary","w-100",3,"click"],[1,"alert","alert-danger","mt-4"],[1,"p-1"],[1,"accordion-item"],[1,"accordion-header"],["type","button","data-bs-toggle","collapse",1,"accordion-button","py-3"],["data-bs-parent","#accordionExample",1,"accordion-collapse","collapse",3,"id","ngClass"],[1,"accordion-body"],[1,"fs-5","mb-3"],[4,"ngFor","ngForOf"],["class","alert alert-info mt-4",4,"ngIf"],["class","alert alert-danger ",4,"ngIf"],[1,"form-check","mb-2"],["type","radio","required","",1,"form-check-input",3,"ngModelChange","name","value","id","ngModel","disabled"],[1,"form-check-label",3,"for"],[1,"alert","alert-info","mt-4"],[1,"alert","alert-danger"]],template:function(t,e){if(t&1){let n=w();V(0,"app-nav"),s(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4),y(5,ae,2,0,"div",5),s(6,"div",6)(7,"h2",7),u(8),d()(),s(9,"div",8)(10,"form",9,0),S("ngSubmit",function(){v(n);let oe=E(11);return f(e.votar(oe))}),y(12,le,12,11,"div",10),s(13,"div",11)(14,"button",12),u(15," Votar "),d(),s(16,"button",13),S("click",function(){return v(n),f(e.resultados())}),u(17," Ver resultados "),d(),s(18,"button",14),S("click",function(){return v(n),f(e.volver(e.currentRole))}),u(19," Volver "),d()()()()()()()(),V(20,"app-footer")}if(t&2){let n=E(11);a(5),p("ngIf",!e.preguntas||e.preguntas.length===0),a(3),j(e.preguntas[0].titulo_asamblea||"No se proporcion\xF3 un t\xEDtulo"),a(4),p("ngForOf",e.preguntas),a(2),p("disabled",e.preguntas.length<=0||!n.form.valid)}},dependencies:[R,D,B,z,q,K,$,G,Q,L,H,X,Z],styles:[".container[_ngcontent-%COMP%]{padding:1rem}.abs-center[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;min-height:70vh}.card[_ngcontent-%COMP%]{min-width:90vw}"]});let r=i;return r})();var pe=[{path:"",component:ie}],re=(()=>{let i=class i{};i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=b({type:i}),i.\u0275inj=h({imports:[F.forChild(pe),F]});let r=i;return r})();var je=(()=>{let i=class i{};i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=b({type:i}),i.\u0275inj=h({providers:[x,C,I],imports:[J,re,ee]});let r=i;return r})();export{je as PreguntasUsModule};
