import{a as M}from"./chunk-XPYVCOT5.js";import{a as N}from"./chunk-Y3RCPZZP.js";import{a as E,c as Y,d as Z,e as $,h as te}from"./chunk-ZLLD3L34.js";import{$ as z,D as A,E as B,F as p,Ga as J,H as r,Ha as D,I as n,J as g,K as P,L as u,La as L,M as h,Ma as q,P as o,Pa as H,Q as b,R as T,S as x,T as I,Ta as G,U as w,Ua as K,Va as Q,Wa as X,Z as f,_,a as F,b as O,bb as ee,da as V,ea as W,ga as U,ia as R,l as C,p as k,q as y,r as v,s as j,x as d,y as S}from"./chunk-ZHU3U647.js";function re(l,a){if(l&1&&(r(0,"option",22),o(1),n()),l&2){let c=a.$implicit;p("value",c.id_conjunto),d(),T(" ",c.nombre_conjunto," ")}}function se(l,a){l&1&&(r(0,"option",23),o(1,"No se encontraron conjuntos."),n())}function le(l,a){l&1&&(r(0,"p"),o(1,"No hay conjuntos asignados."),n())}function de(l,a){if(l&1){let c=P();r(0,"div",24)(1,"div",25)(2,"div",26)(3,"h5",27),o(4),n(),r(5,"p",28),o(6," Fecha inicio: "),r(7,"span",29),o(8),f(9,"date"),n(),g(10,"br"),o(11," Hora inicio: "),r(12,"span",29),o(13),f(14,"date"),n(),g(15,"br"),o(16," Fecha fin: "),r(17,"span",29),o(18),f(19,"date"),n(),g(20,"br"),o(21," Hora fin: "),r(22,"span",29),o(23),f(24,"date"),n()()(),r(25,"div",30)(26,"button",31),u("click",function(){let t=v(c).$implicit,e=h();return j(e.iniciarAsamblea(t.id_asamblea))}),r(27,"i",8),o(28,"arrow_right_alt"),n(),o(29," Iniciar asamblea "),n(),r(30,"button",32),u("click",function(){let t=v(c).$implicit,e=h();return j(e.editarPreguntas(t.id_asamblea))}),r(31,"i",33),o(32,"edit"),n(),o(33," Preguntas "),n(),r(34,"button",34)(35,"i",35),o(36,"close"),n(),o(37," Cerrar Asamblea "),n(),r(38,"div",36)(39,"div",37)(40,"div",38)(41,"div",39)(42,"h5",40),o(43,"Cerrar asamblea"),n(),g(44,"button",41),n(),r(45,"div",42)(46,"h6"),o(47),n(),A(48,le,2,0,"ng-template",null,0,z),n(),r(50,"div",43)(51,"button",44),u("click",function(){let t=v(c).$implicit,e=h();return j(e.toggleEstado(t))}),o(52,"Si, cerrar asamblea"),n(),r(53,"button",45),o(54,"Volver"),n()()()()()()()()}if(l&2){let c=a.$implicit,i=a.index,t=h();d(4),b(c.titulo),d(4),b(_(9,10,c.fecha_inicio,"dd-MM-yyyy")),d(5),b(_(14,13,c.fecha_inicio,"hh:mm a")),d(5),b(_(19,16,c.fecha_fin,"dd-MM-yyyy")),d(5),b(_(24,19,c.fecha_fin,"hh:mm a")),d(3),p("disabled",!t.estaDentroDelRango(c.fecha_inicio,c.fecha_fin)||c.estado!=="Activo"),d(8),p("disabled",c.estado==="Inactivo"),B("data-bs-target","#modalConjuntos"+i),d(4),p("id","modalConjuntos"+i),d(9),T("\xBFEsta seguro que desea cerrar la asamblea: ",c.titulo,"?")}}function me(l,a){l&1&&(r(0,"div",46),o(1," No se encontraron asambleas. "),n())}var ne=(()=>{let a=class a{constructor(i,t,e){this.asambleaService=i,this.router=t,this.adminConjuntoService=e,this.page=1,this.pageSize=3,this.totalAsambleas=0,this.nombreAsamblea="",this.asambleas=[],this.adminConjuntos=[],this.admin={},this.filteredAsambleas=[],this.searchAdmin="",this.usuarioActual=""}ngOnInit(){this.getAll();let t=JSON.parse(localStorage.getItem("currentUser")??"{}").id_admin||"Usuario desconocido";this.admin.id_admin=t,this.adminConjuntoService.getById(E.getAllAdminConjuntos,t).subscribe(e=>{this.adminConjuntos=e.respuesta||[],this.adminConjuntos.length>0&&(this.selectedConjuntoId=Number(this.adminConjuntos[0].id_conjunto)||void 0,this.selectedNombreConjunto=String(this.adminConjuntos[0].nombre_conjunto)||void 0,this.getAll(this.selectedConjuntoId),localStorage.setItem("conjunto",JSON.stringify({id_conjunto:this.selectedConjuntoId,nombre_conjunto:this.selectedNombreConjunto})))})}crearAsamblea(){this.router.navigate(["/asambleas/creacion-asamblea"])}iniciarAsamblea(i){this.router.navigate(["/asambleas/preguntas",i])}editarPreguntas(i){localStorage.setItem("asambleaId",JSON.stringify({id_asamblea:i})),this.router.navigate(["/asambleas/editar-preguntas",i])}getAll(i){let t=JSON.parse(localStorage.getItem("currentUser")??"{}");if(this.usuarioActual=t.id_admin||"Usuario desconocido",!i&&!this.selectedConjuntoId)return;let e={adminId:this.usuarioActual};(i||this.selectedConjuntoId)&&(e.conjuntoId=i||this.selectedConjuntoId),this.asambleaService.getAsambleasAdmin(E.getAllAsambleas,e).subscribe(m=>{Array.isArray(m.respuesta)?(this.asambleas=m.respuesta.map(s=>O(F({},s),{fecha_inicio:new Date(s.fecha_inicio),fecha_fin:new Date(s.fecha_fin)})),this.asambleas.sort((s,oe)=>new Date(oe.fecha_inicio).getTime()-new Date(s.fecha_inicio).getTime())):this.asambleas=[],this.totalAsambleas=this.asambleas.length,this.filterAsambleas()})}onConjuntoChange(i){let t=i.target,e=Number(t?.value),m=this.adminConjuntos.find(s=>s.id_conjunto===e);m?(this.selectedConjuntoId=m.id_conjunto,this.selectedNombreConjunto=m.nombre_conjunto,localStorage.setItem("conjunto",JSON.stringify({id_conjunto:this.selectedConjuntoId,nombre_conjunto:this.selectedNombreConjunto})),this.getAll(this.selectedConjuntoId)):console.error("Conjunto no encontrado")}filterAsambleas(){let i=this.searchAdmin.toLowerCase(),t=this.asambleas.filter(m=>m.titulo.toLowerCase().includes(i)||m.descripcion.includes(i));this.totalAsambleas=t.length;let e=(this.page-1)*this.pageSize;this.filteredAsambleas=t.slice(e,e+this.pageSize)}estaDentroDelRango(i,t){let e=new Date(i),m=new Date(t),s=new Date;return e<=s&&s<=m}trackById(i,t){return t.id_asamblea??i}onSearchTermChange(){this.page=1,this.filterAsambleas()}toggleEstado(i){this.asambleaService.delete(E.deleteAsamblea,i.id_asamblea,i).subscribe({next:t=>{console.log("Estado de la pregunta actualizado exitosamente:",t),window.location.reload()},error:t=>{console.error("Error al actualizar el estado de la pregunta:",t),t.status===401?console.error("No autorizado, redirigiendo al login"):console.error("Error no manejado:",t)}})}};a.\u0275fac=function(t){return new(t||a)(S(N),S(J),S(M))},a.\u0275cmp=k({type:a,selectors:[["app-asambleas"]],decls:29,vars:11,consts:[["noConjuntos",""],[1,"container","py-3"],[1,"abs-center"],[1,"card","card-primary","shadow","border-0"],[1,"card-body"],[1,"text-center","fs-2","text-primary","mb-4"],[1,"d-flex","flex-column","flex-md-row","justify-content-between","align-items-md-center","mb-3"],["type","button",1,"btn","btn-success","mb-3",3,"click"],[1,"material-icons","align-middle","me-1"],[1,"input-group","w-auto","mb-2"],["id","idconjunto","name","id_conjunto","required","",1,"form-select",3,"ngModelChange","change","ngModel"],["disabled","","selected","",3,"value"],[3,"value",4,"ngFor","ngForOf"],["disabled","",4,"ngIf"],[1,"input-group","w-auto"],["type","text","placeholder","Buscar asamblea...",1,"form-control",3,"ngModelChange","input","ngModel"],["id","basic-addon1",1,"input-group-text"],[1,"material-icons"],["class","mb-3 card card-secondary rounded-3 shadow-sm ",4,"ngFor","ngForOf","ngForTrackBy"],["class","text-center text-muted mt-3",4,"ngIf"],[1,"d-flex","justify-content-between","p-2"],[3,"pageChange","collectionSize","page","pageSize"],[3,"value"],["disabled",""],[1,"mb-3","card","card-secondary","rounded-3","shadow-sm"],[1,"row","align-items-center"],[1,"col-12","col-md-8"],[1,"text-primary","fw-bold"],[1,"mb-1","text-muted"],[1,"fw-semibold"],[1,"col-12","col-md-4","d-flex","flex-column","gap-2"],["type","button","aria-label","Iniciar asamblea",1,"btn","btn-primary","w-100","d-flex","align-items-center","justify-content-center",3,"click","disabled"],["title","Editar preguntas","aria-label","Editar preguntas",1,"btn","btn-warning","d-flex","align-items-center","justify-content-center",3,"click"],[1,"material-icons","align-middle","me-2"],["data-bs-toggle","modal",1,"btn","btn-danger",3,"disabled"],[1,"material-icons","align-middle"],["tabindex","-1","aria-hidden","true",1,"modal","fade",3,"id"],[1,"modal-dialog","modal-dialog-centered"],[1,"modal-content"],[1,"modal-header","bg-danger","text-white"],[1,"modal-title"],["type","button","data-bs-dismiss","modal","aria-label","Close",1,"btn-close"],[1,"modal-body"],[1,"modal-footer"],["type","button","data-bs-dismiss","modal",1,"btn","btn-danger",3,"click"],["type","button","data-bs-dismiss","modal",1,"btn","btn-secondary"],[1,"text-center","text-muted","mt-3"]],template:function(t,e){t&1&&(g(0,"app-animation")(1,"app-nav"),r(2,"div",1)(3,"div",2)(4,"div",3)(5,"div",4)(6,"h2",5),o(7,"Asambleas"),n(),r(8,"div",6)(9,"button",7),u("click",function(){return e.crearAsamblea()}),r(10,"i",8),o(11,"add_circle"),n(),o(12," Crear nueva asamblea "),n(),r(13,"div",9)(14,"select",10),w("ngModelChange",function(s){return I(e.selectedConjuntoId,s)||(e.selectedConjuntoId=s),s}),u("change",function(s){return e.onConjuntoChange(s)}),r(15,"option",11),o(16,"Seleccione un conjunto"),n(),A(17,re,2,2,"option",12)(18,se,2,0,"option",13),n()(),r(19,"div",14)(20,"input",15),w("ngModelChange",function(s){return I(e.searchAdmin,s)||(e.searchAdmin=s),s}),u("input",function(){return e.onSearchTermChange()}),n(),r(21,"span",16)(22,"i",17),o(23,"search"),n()()()(),A(24,de,55,22,"div",18)(25,me,2,0,"div",19),n(),r(26,"div",20)(27,"ngb-pagination",21),w("pageChange",function(s){return I(e.page,s)||(e.page=s),s}),u("pageChange",function(){return e.getAll(e.selectedConjuntoId)}),n()()()()(),g(28,"app-footer")),t&2&&(d(14),x("ngModel",e.selectedConjuntoId),d(),p("value",null),d(2),p("ngForOf",e.adminConjuntos),d(),p("ngIf",e.adminConjuntos.length===0),d(2),x("ngModel",e.searchAdmin),d(4),p("ngForOf",e.filteredAsambleas)("ngForTrackBy",e.trackById),d(),p("ngIf",e.filteredAsambleas.length===0),d(2),p("collectionSize",e.totalAsambleas),x("page",e.page),p("pageSize",e.pageSize))},dependencies:[V,W,K,Q,L,G,q,X,H,Y,Z,$,ee,U],styles:[".abs-center[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;min-height:70vh}.card-primary[_ngcontent-%COMP%]{min-width:90vw}.card-secondary[_ngcontent-%COMP%]{padding:.5rem}"]});let l=a;return l})();var ce=[{path:"",component:ne}],ae=(()=>{let a=class a{};a.\u0275fac=function(t){return new(t||a)},a.\u0275mod=y({type:a}),a.\u0275inj=C({imports:[D.forChild(ce),D]});let l=a;return l})();var Oe=(()=>{let a=class a{};a.\u0275fac=function(t){return new(t||a)},a.\u0275mod=y({type:a}),a.\u0275inj=C({providers:[N,M],imports:[R,ae,te]});let l=a;return l})();export{Oe as AsambleasModule};
